(function(e){function n(n){for(var r,i,s=n[0],c=n[1],d=n[2],u=0,m=[];u<s.length;u++)i=s[u],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&m.push(a[i][0]),a[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);l&&l(n);while(m.length)m.shift()();return o.push.apply(o,d||[]),t()}function t(){for(var e,n=0;n<o.length;n++){for(var t=o[n],r=!0,s=1;s<t.length;s++){var c=t[s];0!==a[c]&&(r=!1)}r&&(o.splice(n--,1),e=i(i.s=t[0]))}return e}var r={},a={app:0},o=[];function i(n){if(r[n])return r[n].exports;var t=r[n]={i:n,l:!1,exports:{}};return e[n].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.m=e,i.c=r,i.d=function(e,n,t){i.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,n){if(1&n&&(e=i(e)),8&n)return e;if(4&n&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(i.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)i.d(t,r,function(n){return e[n]}.bind(null,r));return t},i.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(n,"a",n),n},i.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},i.p="/3d-to-spritesheet/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=n,s=s.slice();for(var d=0;d<s.length;d++)n(s[d]);var l=c;o.push([0,"chunk-vendors"]),t()})({0:function(e,n,t){e.exports=t("56d7")},"034f":function(e,n,t){"use strict";t("85ec")},"56d7":function(e,n,t){"use strict";t.r(n);t("e260"),t("e6cf"),t("cca6"),t("a79d");var r=t("2b0e"),a=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{attrs:{id:"app"},on:{drop:function(n){return n.preventDefault(),e.droppedFiles.apply(null,arguments)},dragover:function(e){e.preventDefault()}}})},o=[],i=t("2909"),s=t("1da1"),c=(t("96cf"),t("b64b"),t("4e82"),t("99af"),t("ac1f"),t("5319"),t("e9c4"),t("33d1"),t("ea98"),t("1276"),t("7db0"),t("d3b7"),t("b0c0"),t("caad"),t("2532"),t("3ca3"),t("ddb0"),t("2b3d"),t("9861"),t("4de4"),t("07ac"),t("5cc6"),t("907a"),t("9a8c"),t("a975"),t("735e"),t("c1ac"),t("d139"),t("3a7b"),t("d5d6"),t("82f8"),t("e91f"),t("60bd"),t("5f96"),t("3280"),t("3fcc"),t("ca91"),t("25a1"),t("cd26"),t("3c5d"),t("2954"),t("649e"),t("219c"),t("170b"),t("b39a"),t("72f7"),t("d81d"),t("159b"),t("5a89")),d=t("4721"),l=t("8710"),u=t("d8dd"),m=t("9fe7"),f=t("ef20"),p=t("b9d8"),h=t("c4e3"),g=t.n(h),b=t("21a6"),v=t("bc3a"),w=t.n(v),x=Math.PI/6,F={data:function(){for(var e=16,n={},t=0;t<e;t++){var r=360/e*t;if(!(r>90&&r<270)){var a=r*Math.PI/180;n[r]=[-Math.cos(a)*x,1.05,Math.sin(a)*x]}}return{currentModel:null,directionalLight:null,modelReady:!1,renderer:null,camera:null,gui:null,scene:null,mixer:null,activeAction:null,animationActions:{},animationsFolder:null,modelFolder:null,actionsFolder:null,recordParams:{frames:4,frameSize:256,sheetSize:4096},angles:n,isRecording:!1}},methods:{setAction:function(e){if(e!=this.activeAction){var n=this.activeAction;this.activeAction=e,n&&n.stop(),this.activeAction.play()}},recordAllAsFrames:function(){var e=arguments,n=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,a,o,i,s,c,d,l,u,m,f;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=e.length>0&&void 0!==e[0]?e[0]:"test",a=Object.keys(n.angles),a.sort((function(e,n){return parseInt(e)-parseInt(n)})),o=Object.keys(n.animationActions),i=new g.a,s=0;case 6:if(!(s<o.length)){t.next=22;break}c=0;case 8:if(!(c<a.length)){t.next=19;break}return d=a[c],n.updateAngle(d),l=o[s],u=n.animationActions[l],m=u.action,f=u.frames,console.log("Generating ".concat(l," animation at angle ").concat(d)),t.next=16,n.generateFrameFromAnimation(i,m,f,"".concat(l," ").concat(d));case 16:c++,t.next=8;break;case 19:s++,t.next=6;break;case 22:i.generateAsync({type:"blob",streamFiles:!0}).then((function(e){Object(b["saveAs"])(e,"".concat(r,".zip"))}));case 23:case"end":return t.stop()}}),t)})))()},recordAllAsSheets:function(){var e=arguments,n=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,a,o,i,s,c,d,l,u,m,f;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=e.length>0&&void 0!==e[0]?e[0]:"test",a=Object.keys(n.angles),a.sort((function(e,n){return parseInt(e)-parseInt(n)})),o=Object.keys(n.animationActions),i=n.initRecordings(r),s=0;case 6:if(!(s<o.length)){t.next=22;break}c=0;case 8:if(!(c<a.length)){t.next=19;break}return d=a[c],n.updateAngle(d),l=o[s],u=n.animationActions[l],m=u.action,f=u.frames,console.log("Generating ".concat(l," animation at angle ").concat(d)),t.next=16,n.drawFramesFromAnimation(i,m,f,l,d);case 16:c++,t.next=8;break;case 19:s++,t.next=6;break;case 22:n.finishRecordings(i),i.zip.generateAsync({type:"blob",streamFiles:!0}).then((function(e){Object(b["saveAs"])(e,"".concat(r,".zip"))}));case 24:case"end":return t.stop()}}),t)})))()},recordAnimation:function(e){var n=arguments,t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var a,o,i,s,c,d;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:a=n.length>1&&void 0!==n[1]?n[1]:"test",o=t.initRecordings(a),i=Object.keys(t.angles),i.sort((function(e,n){return parseInt(e)-parseInt(n)})),s=0;case 5:if(!(s<i.length)){r.next=14;break}return c=i[s],t.updateAngle(c),d=t.animationActions[a].frames,r.next=11,t.drawFramesFromAnimation(o,e,d,a,c);case 11:s++,r.next=5;break;case 14:t.finishRecordings(o),o.zip.generateAsync({type:"blob"}).then((function(e){Object(b["saveAs"])(e,"".concat(a,".zip"))}));case 16:case"end":return r.stop()}}),r)})))()},initRecordings:function(e){var n=document.createElement("canvas");n.width=this.recordParams.sheetSize,n.height=this.recordParams.sheetSize;var t=n.getContext("2d");return{zip:new g.a,canvas:n,ctx:t,row:0,column:0,sheet:0,json:{},modelName:e}},finishRecordings:function(e){(e.column>0||e.row>0)&&e.zip.file("".concat(e.modelName,"_").concat(e.sheet,".png"),e.canvas.toDataURL("image/png").replace("data:image/png;base64,",""),{base64:!0}),e.zip.file("animations.json",JSON.stringify(e.json,null,"\t"))},generateFrameFromAnimation:function(e,n,t,r){var a=this;return Object(s["a"])(regeneratorRuntime.mark((function o(){var i,s,c,d;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return a.setAction(n),i=n._clip.duration,s=t||a.recordParams.frames,c=i/s,a.isRecording=!0,o.next=7,A();case 7:d=0;case 8:if(!(d<s)){o.next=16;break}return e.file("".concat(r," ").concat(d+1,".png"),a.getPNGDataUrl().replace("data:image/png;base64,",""),{base64:!0}),a.mixer.update(c),o.next=13,A();case 13:d++,o.next=8;break;case 16:a.isRecording=!1;case 17:case"end":return o.stop()}}),o)})))()},drawFramesFromAnimation:function(e,n,t,r,a){var o=this;return Object(s["a"])(regeneratorRuntime.mark((function i(){var s,c,d,l;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return o.setAction(n),s=n._clip.duration,c=t||o.recordParams.frames,d=s/c,c<=1&&(d=0),o.isRecording=!0,i.next=8,A();case 8:l=0;case 9:if(!(l<c)){i.next=17;break}return o.drawFrameFromAnimation(e,r,a),o.mixer.update(d),i.next=14,A();case 14:l++,i.next=9;break;case 17:o.isRecording=!1;case 18:case"end":return i.stop()}}),i)})))()},drawFrameFromAnimation:function(e,n,t){var r=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var o,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:e.ctx.drawImage(r.renderer.domElement,e.column*r.recordParams.frameSize,e.row*r.recordParams.frameSize),o=r.recordParams.sheetSize/r.recordParams.frameSize,e.json[n]||(e.json[n]={sheet:"".concat(e.modelName,"_").concat(e.sheet,".png"),directions:{}}),e.json[n].directions[t]||(e.json[n].directions[t]=[]),e.json[n].directions[t].push(e.row*o+e.column),90!=t&&270!=t&&(i=null,i=t<90?180-t:360-t+180,e.json[n].directions[i]||(e.json[n].directions[i]=[]),e.json[n].directions[i].push(e.row*o+e.column)),e.column++,e.column>=o&&(e.column=0,e.row++,e.row>=o&&(e.zip.file("".concat(e.modelName,"_").concat(e.sheet,".png"),e.canvas.toDataURL("image/png").replace("data:image/png;base64,",""),{base64:!0}),e.row=0,s=document.createElement("canvas"),s.width=r.recordParams.sheetSize,s.height=r.recordParams.sheetSize,e.canvas=s,e.ctx=s.getContext("2d"),e.sheet++));case 8:case"end":return a.stop()}}),a)})))()},getPNGDataUrl:function(){return this.renderer.domElement.toDataURL("image/png")},onWindowResize:function(){var e=Math.min(window.innerWidth,window.innerHeight),n=e/this.recordParams.frameSize;this.renderer.domElement.style.transform="scale(".concat(n,")")},addAnimation:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;this.animationActions[e]={frames:t,action:n}},updateAngle:function(e){var n,t=this.angles[e];(n=this.camera.position).set.apply(n,Object(i["a"])(t)),this.directionalLight.position.copy(this.camera.position)},loadModelFromUrls:function(e){var n=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,a,o,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=[],a=0;case 2:if(!(a<e.length)){t.next=11;break}return o=e[a],t.next=6,w.a.get(o,{responseType:"blob"});case 6:i=t.sent,r.push({name:o.split("/").at(-1).toLowerCase(),blob:i.data});case 8:a++,t.next=2;break;case 11:n.loadModelFromFiles(r);case 12:case"end":return t.stop()}}),t)})))()},loadModelFromFiles:function(e){var n=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,a,o,i,s,d,f,p,h,g,b,v;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n.currentModel&&(n.scene.remove(n.currentModel),n.currentModel=null),n.animationActions={},n.modelReady=!1,r=new u["a"],r.addHandler(/\.tga$/i,new m["a"](r)),a=new l["a"](r),o=e.find((function(e){var n=e.name;return n.toLowerCase().includes(".fbx")&&!n.includes("@")})),i=o.blob,s=o.name,t.next=11,n.fixModelData(i);case 11:return i=t.sent,d=e.find((function(e){var n=e.name;return n.includes(".tga")})).blob,r.setURLModifier((function(n){var t=e.find((function(e){var t=e.name;return t.includes(n)}));return s.includes(n)?URL.createObjectURL(i):t?URL.createObjectURL(t.blob):n.includes(".tga")&&d?URL.createObjectURL(d):n})),f={},p={},t.next=18,R(a,s);case 18:if(h=n.currentModel=t.sent,h.scale.set(.01,.01,.01),n.mixer=new c["c"](h),n.scene.add(h),n.modelFolder)while(n.modelFolder.__controllers.length)n.modelFolder.remove(n.modelFolder.__controllers[0]);else n.modelFolder=n.gui.addFolder("Model");n.modelFolder.add(h.position,"x",-4,4).step(.1).listen(),n.modelFolder.add(h.position,"y",-4,4).step(.1).listen(),n.modelFolder.add(h.position,"z",-4,4).step(.1).listen();while(n.animationsFolder.__controllers.length)n.animationsFolder.remove(n.animationsFolder.__controllers[0]);while(n.actionsFolder.__controllers.length>3)n.actionsFolder.remove(n.actionsFolder.__controllers.at(-1));g=e.filter((function(e){var n=e.name;return n.includes("@")&&n.toLowerCase().includes(".fbx")})),b=regeneratorRuntime.mark((function e(t){var r,o,i,s,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=g[t].name,o=r.substring(r.indexOf("@")+1,r.toLowerCase().lastIndexOf(".fbx")),e.next=4,R(a,r);case 4:i=e.sent,s=n.mixer.clipAction(i.animations[0]),f[o]=function(){n.setAction(s)},n.animationsFolder.add(f,o),p[o]=function(){n.recordAnimation(s,o)},n.actionsFolder.add(p,o),c=n.recordParams.frames,"idle"===o?c=1:o.includes("attack")&&(c=8),n.addAnimation(o,s,c);case 13:case"end":return e.stop()}}),e)})),v=0;case 31:if(!(v<g.length)){t.next=36;break}return t.delegateYield(b(v),"t0",33);case 33:v++,t.next=31;break;case 36:n.modelReady=!0,n.animationActions.idle?n.setAction(n.animationActions.idle.action):Object.values(n.animationActions).length>0&&n.setAction(Object.values(n.animationActions)[0].action);case 38:case"end":return t.stop()}}),t)})))()},fixModelData:function(e){return Object(s["a"])(regeneratorRuntime.mark((function n(){var t,r,a,o,i,s,c,d,l;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.arrayBuffer();case 2:t=n.sent,r=new Uint8Array(t),a=0,o=[".","p","s","d"].map((function(e){return e.charCodeAt(0)})),i=[".","t","g","a"].map((function(e){return e.charCodeAt(0)})),s=0;case 8:if(!(s<r.length)){n.next=22;break}c=!0,d=0;case 11:if(!(d<o.length)){n.next=18;break}if(r[s+d]===o[d]){n.next=15;break}return c=!1,n.abrupt("break",18);case 15:d++,n.next=11;break;case 18:if(c)for(a++,l=0;l<o.length;l++)r[s+l]=i[l];case 19:s++,n.next=8;break;case 22:return a>0&&console.warn("Fixed: replaced .psd with .tga ".concat(a," times")),n.abrupt("return",new Blob([t]));case 24:case"end":return n.stop()}}),n)})))()},droppedFiles:function(e){var n=Object(i["a"])(e.dataTransfer.files),t=n.find((function(e){return e.name.toLowerCase().includes(".fbx")&&!e.name.includes("@")})),r=n.find((function(e){return e.name.toLowerCase().includes(".tga")}));t&&r?this.loadModelFromFiles(n.map((function(e){return{blob:e,name:e.name.toLowerCase()}}))):alert("You need to upload at least a fbx and a texture file")}},mounted:function(){var e=this,n=this.scene=new c["N"],t=new c["a"](16777215,.3);t.name="ambient_light",n.add(t);var r=new c["k"](16777215,.8*Math.PI);r.name="main_light",n.add(r),this.directionalLight=r;var a=new c["r"];a.name="hemi_light",n.add(a);var o=this.camera=new c["H"](75,1,.01,1e3);this.updateAngle("90");var i=this.renderer=new c["ab"]({preserveDrawingBuffer:!0,alpha:!0});i.setSize(this.recordParams.frameSize,this.recordParams.frameSize),i.gammaOutput=!0,this.$el.appendChild(i.domElement);var s=new d["a"](o,i.domElement);s.enableDamping=!0,s.target.set(0,0,0),this.loadModelFromUrls(["models/ToonRTS_demo_Knight/model.FBX","models/ToonRTS_demo_Knight/DemoTexture.tga","models/ToonRTS_demo_Knight/model@idle.FBX","models/ToonRTS_demo_Knight/model@run.FBX","models/ToonRTS_demo_Knight/model@attack.FBX"]),window.addEventListener("resize",this.onWindowResize,!1),this.onWindowResize();var l=Object(f["a"])(),u=this.gui=new p["a"];this.animationsFolder=u.addFolder("Animations");var m=u.addFolder("Camera");m.add(o.position,"x",-4,4).name("Position x").step(.01).listen(),m.add(o.position,"y",-4,4).name("Position y").step(.01).listen(),m.add(o.position,"z",-4,4).name("Position z").step(.01).listen(),m.add(o,"fov",-100,100).step(1).listen(),m.add(o,"near",-100,100).step(1).listen(),m.add(o,"far",-100,100).step(1).listen(),m.add(o,"aspect",-100,100).step(1).listen(),m.add(o,"zoom",-100,100).step(.1).listen(),m.add(o.rotation,"x",-4,4).name("Rotation x").step(.01).listen(),m.add(o.rotation,"y",-4,4).name("Rotation y").step(.01).listen(),m.add(o.rotation,"z",-4,4).name("Rotation z").step(.01).listen();var h=u.addFolder("Angles"),g={},b=Object.keys(this.angles);b.sort((function(e,n){return parseInt(e)-parseInt(n)})),b.forEach((function(n){g[n]=function(){e.updateAngle(n)},h.add(g,n)})),this.actionsFolder=u.addFolder("Actions"),this.actionsFolder.add({"Save As Frames":function(){e.recordAllAsFrames("Footman")}},"Save As Frames"),this.actionsFolder.add({"Save As Sheets":function(){e.recordAllAsSheets("Footman")}},"Save As Sheets"),this.actionsFolder.open(),this.frameSettingsFolder=this.gui.addFolder("Frames"),this.frameSettingsFolder.add(this.recordParams,"frames",1,20).step(1).name("Frames").listen(),this.frameSettingsFolder.add(this.recordParams,"frameSize",32,1024).step(32).name("Frame Size").listen().onChange((function(n){i.setSize(n,n),e.onWindowResize()})),this.frameSettingsFolder.add(this.recordParams,"sheetSize",64,16384).step(64).name("Sheet Size").listen();var v=new c["g"],w=function n(){requestAnimationFrame(n),s.update(),e.modelReady&&!e.isRecording&&e.mixer.update(v.getDelta()),x(),l.update()};function x(){i.render(n,o)}w()},destroyed:function(){this.gui.destroy()}};function A(){return new Promise((function(e){requestAnimationFrame((function(){e()}))}))}function R(e,n){return new Promise((function(t,r){e.load(n,(function(e){t(e)}),(function(e){}),(function(e){console.error(e),r(e)}))}))}var y=F,j=(t("034f"),t("2877")),k=Object(j["a"])(y,a,o,!1,null,null,null),S=k.exports;r["a"].config.productionTip=!1,new r["a"]({render:function(e){return e(S)}}).$mount("#app")},"85ec":function(e,n,t){}});
//# sourceMappingURL=app.41a97a49.js.map