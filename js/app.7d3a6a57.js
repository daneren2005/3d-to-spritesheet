(function(e){function t(t){for(var r,o,s=t[0],c=t[1],d=t[2],u=0,m=[];u<s.length;u++)o=s[u],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&m.push(a[o][0]),a[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);l&&l(t);while(m.length)m.shift()();return i.push.apply(i,d||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==a[c]&&(r=!1)}r&&(i.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},a={app:0},i=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/3d-to-spritesheet/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var d=0;d<s.length;d++)t(s[d]);var l=c;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";n("85ec")},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"},on:{drop:function(t){return t.preventDefault(),e.droppedFiles.apply(null,arguments)},dragover:function(e){e.preventDefault()}}})},i=[],o=n("3835"),s=n("2909"),c=n("ade3"),d=n("1da1"),l=n("668b"),u=(n("96cf"),n("b64b"),n("99af"),n("d3b7"),n("5cc6"),n("907a"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("159b"),n("07ac"),n("ac1f"),n("5319"),n("e9c4"),n("b0c0"),n("d81d"),n("4de4"),n("caad"),n("2532"),n("33d1"),n("ea98"),n("1276"),n("7db0"),n("3ca3"),n("ddb0"),n("2b3d"),n("9861"),n("4e82"),n("5a89")),m=n("4721"),h=n("8710"),f=n("d8dd"),g=n("9fe7"),p=n("ef20"),w=n("b9d8"),x=n("c4e3"),v=n.n(x),b=n("21a6"),F=n("bc3a"),A=n.n(F),S=n("a2d6");n("a630");function y(e){return k.apply(this,arguments)}function k(){return k=Object(d["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(t.dataTransfer.items&&t.dataTransfer.items.length&&t.dataTransfer.items[0].webkitGetAsEntry)){e.next=7;break}return n=Array.from(t.dataTransfer.items).map((function(e){return e.webkitGetAsEntry()})),e.next=4,P(n);case 4:return e.abrupt("return",e.sent);case 7:return e.abrupt("return",Object(s["a"])(t.dataTransfer.files));case 8:case"end":return e.stop()}}),e)}))),k.apply(this,arguments)}function P(e){return R.apply(this,arguments)}function R(){return R=Object(d["a"])(regeneratorRuntime.mark((function e(t){var n,r,a,i,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=[],r=0;case 2:if(!(r<t.length)){e.next=36;break}if(a=t[r],a){e.next=6;break}return e.abrupt("continue",33);case 6:if(!a.isFile){e.next=14;break}return e.t0=n,e.next=10,j(a);case 10:e.t1=e.sent,e.t0.push.call(e.t0,e.t1),e.next=33;break;case 14:if(!a.isDirectory){e.next=33;break}return i=a.createReader(),e.next=18,z(i);case 18:o=e.sent;case 19:if(!(o.length>0)){e.next=33;break}return e.t2=n.push,e.t3=n,e.t4=s["a"],e.next=25,P(o);case 25:return e.t5=e.sent,e.t6=(0,e.t4)(e.t5),e.t2.apply.call(e.t2,e.t3,e.t6),e.next=30,z(i);case 30:o=e.sent,e.next=19;break;case 33:r++,e.next=2;break;case 36:return e.abrupt("return",n);case 37:case"end":return e.stop()}}),e)}))),R.apply(this,arguments)}function z(e){return O.apply(this,arguments)}function O(){return O=Object(d["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){t.readEntries(e,n)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),O.apply(this,arguments)}function j(e){return M.apply(this,arguments)}function M(){return M=Object(d["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.file((function(t){return e(t)}),(function(e){return n(e)}))})));case 1:case"end":return e.stop()}}),e)}))),M.apply(this,arguments)}var T=n("5530");function C(e,t,n){var r=Math.max(e.x,e.y,e.z),a=r*(n.distance||1),i=r*(n.shadowDistance||1),o=_(90),s=_(n.viewAngle),c=_(180-n.shadowSideAngle),d=_(180-n.shadowHeightAngle),l={position:E(.25*a,{x:e.x,y:1.6*e.y,z:e.z},o,0),target:[0,e.y/2*1.6,0],light:E(i,e,c,d),startAngle:270};return t&&t.icon&&t.icon.camera&&(l=Object(T["a"])(Object(T["a"])({},l),t.icon.camera)),{spritesheet:{position:E(a,e,o,s),target:[(t.cameraTarget?t.cameraTarget.x:null)||0,(t.cameraTarget?t.cameraTarget.y:null)||e.y/2,(t.cameraTarget?t.cameraTarget.z:null)||0],light:E(i,e,c,d)},icon:l}}function _(e){return"string"===typeof e&&(e=parseFloat(e)),isNaN(e)&&(e=90),e*Math.PI/180}function E(e,t,n,r){var a=-e*Math.cos(n)*Math.sin(r),i=t.y/2+e*Math.sin(r),o=e*Math.sin(n)*Math.cos(r);return[a,i,o]}var N=null,D=null,L=new Worker("pngquant/worker.js");function X(e){return H.apply(this,arguments)}function H(){return H=Object(d["a"])(regeneratorRuntime.mark((function e(t){var n,r=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=r.length>1&&void 0!==r[1]?r[1]:{},!N){e.next=4;break}return console.error("Trying to start a new job while something is still running"),e.abrupt("return");case 4:return e.abrupt("return",new Promise((function(e,r){L.postMessage({type:"command",arguments:n,file:{name:"input.png",data:t}}),N=e,D=r})));case 5:case"end":return e.stop()}}),e)}))),H.apply(this,arguments)}L.onmessage=function(e){var t=e.data;if("start"===t.type)console.log("worker started");else if("stdout"===t.type)console.log("Worker message: ".concat(t.data));else if("done"===t.type){var n=t.data;1===n.length&&n[0]instanceof Error?(console.error("Worker error: ".concat(n[0])),D(n[0]),N=null,D=null):(N(n[0].data),N=null,D=null)}};var Y=256,I=16,U={data:function(){return{config:null,currentModel:null,directionalLight:null,modelReady:!1,renderer:null,camera:null,gui:null,scene:null,mixer:null,activeAction:null,animationActions:{},animationsFolder:null,modelFolder:null,actionsFolder:null,recordParams:{frames:4,frameSize:Y,sheetSize:4096,distance:1,viewAngle:0,compressPNG:!0,shadows:!0,shadowHeightAngle:0,shadowSideAngle:0,shadowDistance:0,shadowOpacity:0,packTextures:!0},angles:null,angleNames:null,anglesFolder:null,isRecording:!1,directoryHandle:null}},methods:{setAction:function(e){if(e)if(e!=this.activeAction){var t=this.activeAction;this.activeAction=e,t&&t.stop(),this.activeAction.play()}else e.reset();else{var n=this.activeAction;this.activeAction=e,n&&n.stop()}},recordAllAsSheets:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function n(){var r,a,i,o,s,c,d,l,u,m;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r=t.angleNames,a=Object.keys(t.animationActions),i=t.recordParams.sheetSize/t.recordParams.frameSize,o=t.initRecordings(e),s=0;case 5:if(!(s<a.length)){n.next=21;break}if(c=a[s],d=t.animationActions[c].frames,t.recordParams.packTextures){n.next=16;break}if(l=i-1-o.row,u=l*i+(i-o.column),m=d*r.length,!(m>u)){n.next=16;break}return console.warn("skipping to next sheet since we need ".concat(m," slots with ").concat(u," left")),n.next=16,t.startNewSheet(o);case 16:return n.next=18,t.drawFramesFromAnimation(c,o);case 18:s++,n.next=5;break;case 21:return n.next=23,t.finishRecordings(o);case 23:if(!t.config.icon){n.next=32;break}return t.setRenderSize(t.config.icon.size),t.resetSheetCanvas(o),o.canvas.width=t.config.icon.size,o.canvas.height=t.config.icon.size,n.next=30,t.drawFramesFromAnimation("icon",o);case 30:return n.next=32,t.saveImageToZip(o,"icon.png");case 32:o.finishWriting();case 33:case"end":return n.stop()}}),n)})))()},recordAnimationAsSheet:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=t.initRecordings(e),n.next=3,t.drawFramesFromAnimation(e,r);case 3:return n.next=5,t.finishRecordings(r);case 5:r.finishWriting();case 6:case"end":return n.stop()}}),n)})))()},initRecordings:function(e){var t=this,n=document.createElement("canvas");if("icon"===e)n.width=this.config.icon.size,n.height=this.config.icon.size,this.setRenderSize(this.config.icon.size);else{n.width=this.recordParams.sheetSize,n.height=this.recordParams.sheetSize;var r=this.config.frameSize||Y;this.setRenderSize(r)}var a=n.getContext("2d"),i={canvas:n,ctx:a,row:0,column:0,sheet:0,json:{},modelName:e,atlasTextures:[],startX:0,startY:0,maxHeight:0};if(this.directoryHandle)i.saveFile=function(){var e=Object(d["a"])(regeneratorRuntime.mark((function e(n,r){var a,i,o,s,c,d,l,u=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=u.length>2&&void 0!==u[2]?u[2]:{},a.base64){if("string"===typeof r){for(o=window.atob(r),s=new Array(o.length),c=0;c<o.length;c++)s[c]=o.charCodeAt(c);i=new Uint8Array(s)}else i=r;r=new Blob([i],{type:"image/png"})}return e.next=4,t.directoryHandle.getFileHandle(n,{create:!0});case 4:return d=e.sent,e.next=7,d.createWritable();case 7:return l=e.sent,e.next=10,l.write(r);case 10:return e.next=12,l.close();case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),i.finishWriting=function(){alert("done writing files")};else{var o=new v.a;i.saveFile=function(){var e=Object(d["a"])(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:o.file(t,n,r);case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),i.finishWriting=function(){o.generateAsync({type:"blob",streamFiles:!0}).then((function(t){Object(b["saveAs"])(t,"".concat(e,".zip"))}))}}return i},finishRecordings:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!(e.column>0||e.row>0)){n.next=5;break}return r="".concat(e.modelName).concat(e.sheet,".png"),0===e.sheet&&(r="".concat(e.modelName,".png"),Object.values(e.json).forEach((function(e){e.sheet=e.sheet.replace("0.png",".png")})),e.atlasTextures.forEach((function(e){e.image=e.image.replace("0.png",".png")}))),n.next=5,t.saveImageToZip(e,r);case 5:return n.next=7,e.saveFile("animations.json",JSON.stringify(e.json,null,"\t"));case 7:if(!t.recordParams.packTextures){n.next=10;break}return n.next=10,e.saveFile("atlas.json",JSON.stringify({textures:e.atlasTextures},null,"\t"));case 10:case"end":return n.stop()}}),n)})))()},drawFramesFromAnimation:function(e,t){var n=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var a,i,o,s,c,d,l,u,m,h,f,g;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if("icon"!==e){r.next=8;break}return n.updateAngle("icon"),a=n.config.icon.animation,i=n.animationActions[a],o=i.action,s=i.frames,c=i.animationConfig,r.next=6,n.drawFramesFromAnimationAngle(t,o,s,e,"icon",c);case 6:r.next=19;break;case 8:d=n.angleNames,l=n.animationActions[e],u=l.action,m=l.frames,h=l.animationConfig,f=0;case 11:if(!(f<d.length)){r.next=19;break}return g=d[f],n.updateAngle(g),r.next=16,n.drawFramesFromAnimationAngle(t,u,m,e,g,h);case 16:f++,r.next=11;break;case 19:case"end":return r.stop()}}),r)})))()},drawFramesFromAnimationAngle:function(e,t,n,r,a,i){var o=this;return Object(d["a"])(regeneratorRuntime.mark((function s(){var c,d,l,u,m,h,f;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(o.setAction(t),c=o.getActionDuration(t,i),d=n||o.recordParams.frames,l=c/d,d<=1&&(l=0),o.isRecording=!0,u={},!o.recordParams.packTextures){s.next=21;break}return o.mixer.update(0),s.next=11,W();case 11:m=0;case 12:if(!(m<d)){s.next=21;break}return h=o.getStartAndEndPixelsForFrame(),u.trimSize?u.trimSize={startX:Math.min(h.startX,u.trimSize.startX),startY:Math.min(h.startY,u.trimSize.startY),endX:Math.max(h.endX,u.trimSize.endX),endY:Math.max(h.endY,u.trimSize.endY)}:u.trimSize=h,o.mixer.update(l),s.next=18,W();case 18:m++,s.next=12;break;case 21:return o.setAction(t),o.mixer.update(0),s.next=25,W();case 25:f=0;case 26:if(!(f<d)){s.next=35;break}return s.next=29,o.drawFrameFromAnimation(e,r,a,u);case 29:return o.mixer.update(l),s.next=32,W();case 32:f++,s.next=26;break;case 35:o.isRecording=!1;case 36:case"end":return s.stop()}}),s)})))()},getActionDuration:function(e,t){if(!e)return 1;var n=1;return t&&t.skipEnd&&(n=1-t.skipEnd),e._clip.duration*n},drawFrameFromAnimation:function(e,t,n,r){var a=this;return Object(d["a"])(regeneratorRuntime.mark((function i(){var o,s,c,d,l;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(o=a.recordParams.sheetSize/a.recordParams.frameSize,!a.recordParams.packTextures){i.next=13;break}s=r.trimSize,c=s.endX-s.startX,d=s.endY-s.startY,e.startX+c>a.recordParams.sheetSize&&(e.startX=0,e.startY+=e.maxHeight,e.maxHeight=0,e.column=0,e.row++),e.ctx.drawImage(a.renderer.domElement,s.startX,s.startY,c,d,e.startX,e.startY,c,d),e.atlasTextures.length<=e.sheet&&e.atlasTextures.push({image:"".concat(e.modelName).concat(e.sheet,".png"),frames:[]}),e.atlasTextures[e.sheet].frames.push({filename:e.atlasTextures[e.sheet].frames.length,rotated:!1,trimmed:!0,sourceSize:{w:a.recordParams.frameSize,h:a.recordParams.frameSize},spriteSourceSize:{x:s.startX,y:s.startY,w:c,h:d},frame:{x:e.startX,y:e.startY,w:c,h:d}}),e.startX+=c,e.maxHeight=Math.max(e.maxHeight,d),i.next=20;break;case 13:if(!(e.column>=o)){i.next=19;break}if(e.column=0,e.row++,!(e.row>=o)){i.next=19;break}return i.next=19,a.startNewSheet(e);case 19:e.ctx.drawImage(a.renderer.domElement,e.column*a.recordParams.frameSize,e.row*a.recordParams.frameSize);case 20:e.json[t]||(e.json[t]={sheet:"".concat(e.modelName).concat(e.sheet,".png"),directions:{}}),e.json[t].directions[n]||(e.json[t].directions[n]=[]),e.json[t].directions[n].push(e.row*o+e.column),90!=n&&270!=n&&(l=null,l=n<90?180-n:360-n+180,e.json[t].directions[l]||(e.json[t].directions[l]=[]),e.json[t].directions[l].push(e.row*o+e.column)),e.column++;case 25:case"end":return i.stop()}}),i)})))()},getStartAndEndPixelsForFrame:function(){var e=document.createElement("canvas");e.width=this.renderer.domElement.width,e.height=this.renderer.domElement.height;var t=e.getContext("2d");t.drawImage(this.renderer.domElement,0,0);for(var n=t.getImageData(0,0,e.width,e.height),r=n.data,a=e.width,i=0,o=e.height,s=0,c=0;c<r.length/4;c++){var d=4*c,l=r[d+3];if(0!==l){var u=c%e.width,m=Math.floor(c/e.width);a=Math.min(a,Math.max(0,u-1)),o=Math.min(o,Math.max(0,m-1)),i=Math.max(i,u+1),s=Math.max(s,m+1)}}return a===e.width&&(a=0),o===e.height&&(o=0),0===i&&(i=e.width),0===s&&(s=e.height),{startX:a,endX:i,startY:o,endY:s}},saveImageToZip:function(e,t){var n=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var a,i,o,s,c,d;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(a=e.canvas.toDataURL("image/png").replace("data:image/png;base64,",""),i=a,!n.recordParams.compressPNG){r.next=21;break}for(n.isRecording=!0,o=window.atob(a),s=new Uint8Array(o.length),c=0;c<o.length;c++)s[c]=o.charCodeAt(c);return r.prev=7,r.next=10,X(s,{quality:"10-100",speed:"4"});case 10:d=r.sent,i=d,r.next=18;break;case 14:throw r.prev=14,r.t0=r["catch"](7),alert("Failed to run pngquant on image ".concat(t)),r.t0;case 18:return r.prev=18,n.isRecording=!1,r.finish(18);case 21:return r.next=23,e.saveFile(t,i,{base64:!0});case 23:case"end":return r.stop()}}),r,null,[[7,14,18,21]])})))()},startNewSheet:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.saveImageToZip(e,"".concat(e.modelName).concat(e.sheet,".png"));case 2:t.resetSheetCanvas(e),e.sheet++;case 4:case"end":return n.stop()}}),n)})))()},resetSheetCanvas:function(e){e.row=0,e.column=0,e.startX=0,e.startY=0,e.maxHeight=0;var t=document.createElement("canvas");t.width=this.recordParams.sheetSize,t.height=this.recordParams.sheetSize,e.canvas=t,e.ctx=t.getContext("2d")},getPNGDataUrl:function(){return this.renderer.domElement.toDataURL("image/png")},onWindowResize:function(){var e=Math.min(window.innerWidth,window.innerHeight),t=e/this.recordParams.frameSize;this.renderer.domElement.style.transform="scale(".concat(t,")")},addAnimationFromAction:function(e,t){var n=this;t||(t=e.name,Object.keys(this.config.animations).forEach((function(r){e.name===n.config.animations[r].name&&(t=r)})));var r=this.mixer.clipAction(e);this.addAnimationToFolders(t,r);var a=this.recordParams.frames,i=null;this.config.animations[t]&&(this.config.animations[t].frames&&(a=this.config.animations[t].frames),i=this.config.animations[t]),this.addAnimation(t,r,a,i)},addAnimationToFolders:function(e,t){var n=this;this.animationsFolder.add(Object(c["a"])({},e,(function(){n.setAction(t)})),e),this.actionsFolder.add(Object(c["a"])({},e,(function(){n.recordAnimationAsSheet(e)})),e)},addAnimation:function(e,t,n,r){this.animationActions[e]={frames:n,action:t,animationConfig:r}},updateAngle:function(e){var t,n,r,a=this.angles[e]||this.angles.spritesheet;(t=this.camera.position).set.apply(t,Object(s["a"])(a.position)),(n=this.controls.target).set.apply(n,Object(s["a"])(a.target)),(r=this.directionalLight.position).set.apply(r,Object(s["a"])(a.light)),this.directionalLight.castShadow=this.recordParams.shadow;var i=this.config.startAngle||270,o=e;if(a.startAngle&&(o=a.startAngle),this.currentModel.rotation.set(0,_(o-i),0),this.currentAngleName=e,this.floorMaterial.opacity=this.recordParams.shadowOpacity,this.config){var c=this.config.animations[e]||this.config[e];if(c&&c.size)this.setRenderSize(c.size);else{var d=this.config.frameSize||Y;this.setRenderSize(d)}}},setRenderSize:function(e){this.lastRenderSize!=e&&(this.recordParams.frameSize=e,this.renderer.setSize(e,e),this.onWindowResize(),this.lastRenderSize=e)},loadModelFromConfig:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.config=e,this.recordParams.distance=e.distance||1.25,this.recordParams.viewAngle=void 0===e.viewAngle?60:e.viewAngle,e.sheetSize&&(this.recordParams.sheetSize=e.sheetSize),e.frameSize&&this.setRenderSize(e.frameSize),this.recordParams.shadow=void 0===e.shadow||e.shadow,this.recordParams.shadowHeightAngle=void 0!==e.shadowHeightAngle?e.shadowHeightAngle:90,this.recordParams.shadowSideAngle=void 0!==e.shadowSideAngle?e.shadowSideAngle:70,this.recordParams.shadowDistance=void 0!==e.shadowDistance?e.shadowDistance:this.recordParams.distance||1,this.recordParams.shadowOpacity=void 0!==e.shadowOpacity?e.shadowOpacity:.6,this.recordParams.packTextures=void 0!==e.packTextures&&e.packTextures,e.directionalLightIntensity&&(this.directionalLight.intensity=e.directionalLightIntensity);var n=[e.model,e.texture].concat(Object(s["a"])(Object.values(e.animations).map((function(e){return e.name}))));if(t){var r=t.filter((function(e){return n.includes(e.name)})),a=Object.keys(e.animations).filter((function(t){return!r.map((function(e){return e.name})).includes(e.animations[t].name)}));a.forEach((function(t){e.animations[t].name.toLowerCase().includes(".fbx")&&alert("Missing animation files for ".concat(t))})),this.loadModelFromFiles(r.map((function(t){var n=null;return Object.keys(e.animations).forEach((function(r){var a=e.animations[r].name;t.name===a&&(n=r)})),{blob:t,name:t.name.toLowerCase(),animationName:n}})))}else this.loadModelFromUrls(n)},loadModelFromUrls:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function n(){var r,a,i,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r=[],a=0;case 2:if(!(a<e.length)){n.next=11;break}return i=e[a],n.next=6,A.a.get(i,{responseType:"blob"});case 6:o=n.sent,r.push({name:i.split("/").at(-1).toLowerCase(),blob:o.data});case 8:a++,n.next=2;break;case 11:t.loadModelFromFiles(r);case 12:case"end":return n.stop()}}),n)})))()},loadModelFromFiles:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function n(){var r,a,i,o,s,c,d,l,m,p,w,x,v,b,F,A,S,y,k,P;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.currentModel&&(t.scene.remove(t.currentModel),t.currentModel=null),t.animationActions={},t.modelReady=!1,r=new f["a"],r.addHandler(/\.tga$/i,new g["a"](r)),a=new h["a"](r),i=e.find((function(e){var t=e.name;return t.toLowerCase().includes(".fbx")&&!t.includes("@")})),o=i.blob,s=i.name,n.next=11,t.fixModelData(o);case 11:return o=n.sent,c=e.find((function(e){var t=e.name;return t.includes(".tga")})).blob,r.setURLModifier((function(t){var n=e.find((function(e){var n=e.name;return n.includes(t)}));return s.includes(t)?URL.createObjectURL(o):n?URL.createObjectURL(n.blob):t.includes(".tga")&&c?URL.createObjectURL(c):t})),n.next=16,B(a,s);case 16:d=t.currentModel=n.sent,d.scale.set(.01,.01,.01),d.traverse((function(e){e.isMesh&&(e.receiveShadow=!1,e.castShadow=!0)})),t.mixer=new u["c"](d),l=(new u["e"]).setFromObject(d),t.modelDimensions={x:l.max.x-l.min.x,y:l.max.y-l.min.y,z:l.max.z-l.min.z},t.floorPlane.position.set(0,0,0),t.angles=C(t.modelDimensions,t.config,t.recordParams),t.updateAngle("270");while(t.anglesFolder.__controllers.length)t.anglesFolder.remove(t.anglesFolder.__controllers[0]);if(m={icon:function(){t.updateAngle("icon")}},p=[],!t.config.angles){n.next=33;break}p=t.config.angles,p.includes(270)||t.updateAngle(p[0]),n.next=43;break;case 33:w=t.config.anglesCount||I,x=0;case 35:if(!(x<w)){n.next=43;break}if(v=360/w*x,!(v>90&&v<270)){n.next=39;break}return n.abrupt("continue",40);case 39:p.push(v);case 40:x++,n.next=35;break;case 43:if(p.forEach((function(e){m[e]=function(){t.updateAngle(e)},t.anglesFolder.add(m,e)})),t.anglesFolder.add(m,"icon"),t.angleNames=p,t.scene.add(d),t.modelFolder)while(t.modelFolder.__controllers.length)t.modelFolder.remove(t.modelFolder.__controllers[0]);else t.modelFolder=t.gui.addFolder("Model");if(t.modelFolder.add(d.position,"x",-4,4).step(.1).name("Position X").listen(),t.modelFolder.add(d.position,"y",-4,4).step(.1).name("Position Y").listen(),t.modelFolder.add(d.position,"z",-4,4).step(.1).name("Position Z").listen(),t.modelFolder.add(d.rotation,"x",-4,4).step(.1).name("Rotation X").listen(),t.modelFolder.add(d.rotation,"y",-4,4).step(.1).name("Rotation Y").listen(),t.modelFolder.add(d.rotation,"z",-4,4).step(.1).name("Rotation Z").listen(),t.modelFolder.add(t.recordParams,"distance",.5,5).step(.05).name("Distance").listen().onChange((function(e){t.recordParams.distance=e,t.angles=C(t.modelDimensions,t.config,t.recordParams),t.updateAngle(t.currentAngleName)})),t.modelFolder.add(t.recordParams,"viewAngle",0,89).step(1).name("View Angle").listen().onChange((function(e){t.recordParams.viewAngle=e,t.angles=C(t.modelDimensions,t.config,t.recordParams),t.updateAngle(t.currentAngleName)})),t.meshPartsFolder)while(t.meshPartsFolder.__controllers.length)t.meshPartsFolder.remove(t.meshPartsFolder.__controllers[0]);else t.meshPartsFolder=t.gui.addFolder("Mesh Parts");b=t.getMeshes(d),b.sort((function(e,t){return e.name.localeCompare(t.name)})),t.config.meshesEnabled&&b.forEach((function(e){t.config.meshesEnabled.includes(e.name)||(e.visible=!1)})),b.forEach((function(e){t.meshPartsFolder.add(e,"visible").name(e.name)}));while(t.animationsFolder.__controllers.length)t.animationsFolder.remove(t.animationsFolder.__controllers[0]);while(t.actionsFolder.__controllers.length>=3)t.actionsFolder.remove(t.actionsFolder.__controllers.at(-1));F=e.filter((function(e){return e.name.includes("@")&&e.name.toLowerCase().includes(".fbx")||e.animationName})),A=0;case 65:if(!(A<F.length)){n.next=75;break}return S=F[A],y=S.name,k=S.animationName,k||(k=y.substring(y.indexOf("@")+1,y.toLowerCase().lastIndexOf(".fbx"))),n.next=70,B(a,y);case 70:P=n.sent,t.addAnimationFromAction(P.animations[0],k);case 72:A++,n.next=65;break;case 75:d.animations.forEach((function(e){t.addAnimationFromAction(e)})),Object.values(t.animationActions).length||(t.addAnimationToFolders("static",null),t.animationActions.static={frames:1,action:null,animationConfig:{}}),t.config.icon&&t.actionsFolder.add({icon:function(){t.recordAnimationAsSheet("icon")}},"icon"),t.modelReady=!0,t.animationActions.idle?t.setAction(t.animationActions.idle.action):Object.values(t.animationActions).length>0&&t.setAction(Object.values(t.animationActions)[0].action);case 80:case"end":return n.stop()}}),n)})))()},getMeshes:function(e){var t=this,n=[];return e.children.forEach((function(e){"SkinnedMesh"===e.constructor.name||"Mesh"===e.constructor.name?n.push(e):n.push.apply(n,Object(s["a"])(t.getMeshes(e)))})),n},fixModelData:function(e){return Object(d["a"])(regeneratorRuntime.mark((function t(){var n,r,a,i,o,s,c,d,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.arrayBuffer();case 2:n=t.sent,r=new Uint8Array(n),a=0,i=[".","p","s","d"].map((function(e){return e.charCodeAt(0)})),o=[".","t","g","a"].map((function(e){return e.charCodeAt(0)})),s=0;case 8:if(!(s<r.length)){t.next=22;break}c=!0,d=0;case 11:if(!(d<i.length)){t.next=18;break}if(r[s+d]===i[d]){t.next=15;break}return c=!1,t.abrupt("break",18);case 15:d++,t.next=11;break;case 18:if(c)for(a++,l=0;l<i.length;l++)r[s+l]=o[l];case 19:s++,t.next=8;break;case 22:return a>0&&console.warn("Fixed: replaced .psd with .tga ".concat(a," times")),t.abrupt("return",new Blob([n]));case 24:case"end":return t.stop()}}),t)})))()},droppedFiles:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,y(e);case 2:r=n.sent,t.loadConfigFromFiles(r),t.directoryHandle=null;case 5:case"end":return n.stop()}}),n)})))()},loadConfigFromFiles:function(e){var t=this,n=e.find((function(e){return e.name.toLowerCase().includes(".fbx")&&!e.name.includes("@")})),r=e.find((function(e){return e.name.toLowerCase().includes(".tga")}));if(n&&r){var a=e.find((function(e){return"config.json"===e.name.toLowerCase()}));if(a){var i=new FileReader;i.onload=function(n){var r=JSON.parse(n.target.result);t.loadModelFromConfig(r,e)},i.readAsText(a)}else this.loadModelFromFiles(e.map((function(e){return{blob:e,name:e.name.toLowerCase()}})))}else alert("You need to upload at least a fbx and a texture file")},openFolder:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,window.showDirectoryPicker({mode:"readwrite",writable:!0});case 2:return n=t.sent,t.next=5,n.requestPermission({mode:"readwrite"});case 5:return r=[],t.next=8,e.addFilesFromFolder(n,r);case 8:e.loadConfigFromFiles(r),e.directoryHandle=n;case 10:case"end":return t.stop()}}),t)})))()},addFilesFromFolder:function(e,t){var n=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var a,i,s,c,d,u,m,h,f;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:a=!1,i=!1,r.prev=2,c=Object(l["a"])(e.entries());case 4:return r.next=6,c.next();case 6:if(!(a=!(d=r.sent).done)){r.next=22;break}if(u=Object(o["a"])(d.value,2),m=u[0],h=u[1],m=m.toLowerCase(),!(h instanceof window.FileSystemDirectoryHandle)){r.next=14;break}return r.next=12,n.addFilesFromFolder(h,t);case 12:r.next=19;break;case 14:if("config.json"!==m&&!m.includes("fbx")&&!m.includes("tga")){r.next=19;break}return r.next=17,h.getFile();case 17:f=r.sent,t.push(f);case 19:a=!1,r.next=4;break;case 22:r.next=28;break;case 24:r.prev=24,r.t0=r["catch"](2),i=!0,s=r.t0;case 28:if(r.prev=28,r.prev=29,!a||null==c.return){r.next=33;break}return r.next=33,c.return();case 33:if(r.prev=33,!i){r.next=36;break}throw s;case 36:return r.finish(33);case 37:return r.finish(28);case 38:case"end":return r.stop()}}),r,null,[[2,24,28,38],[29,,33,37]])})))()}},mounted:function(){var e=this,t=this.scene=new u["P"],n=new u["a"](16777215,.3);n.name="ambient_light",t.add(n);var r=new u["l"](16777215,.8*Math.PI);r.name="main_light",r.castShadow=!0,r.shadow.mapSize.width=4096,r.shadow.mapSize.height=4096,r.shadow.camera.top=2,r.shadow.camera.bottom=-2,r.shadow.camera.left=-2,r.shadow.camera.right=2,r.shadow.camera.near=.1,r.shadow.camera.far=500,t.add(r),this.directionalLight=r;var a=new u["s"];a.name="hemi_light",t.add(a);var i=this.camera=new u["I"](75,1,.01,1e3),o=this.renderer=new u["db"]({preserveDrawingBuffer:!0,alpha:!0});o.setSize(this.recordParams.frameSize,this.recordParams.frameSize),o.gammaOutput=!0,o.shadowMap.enabled=!0,this.$el.appendChild(o.domElement);var s=this.controls=new m["a"](i,o.domElement);s.enableDamping=!0,s.target.set(0,0,0),this.loadModelFromConfig(S),window.addEventListener("resize",this.onWindowResize,!1),this.onWindowResize();var c=Object(p["a"])(),d=this.gui=new w["a"];this.animationsFolder=d.addFolder("Animations");var l=d.addFolder("Camera");l.add(i.position,"x",-4,4).name("Position x").step(.01).listen(),l.add(i.position,"y",-4,4).name("Position y").step(.01).listen(),l.add(i.position,"z",-4,4).name("Position z").step(.01).listen(),l.add(i.rotation,"x",-4,4).name("Rotation x").step(.01).listen(),l.add(i.rotation,"y",-4,4).name("Rotation y").step(.01).listen(),l.add(i.rotation,"z",-4,4).name("Rotation z").step(.01).listen(),l.add(s.target,"x",-4,4).name("Target x").step(.01).listen(),l.add(s.target,"y",-4,4).name("Target y").step(.01).listen(),l.add(s.target,"z",-4,4).name("Target z").step(.01).listen(),this.anglesFolder=d.addFolder("Angles"),this.actionsFolder=d.addFolder("Actions"),this.actionsFolder.add({"Save As Sheets":function(){e.recordAllAsSheets(e.config.name)}},"Save As Sheets"),this.actionsFolder.add({"Open Folder":function(){e.openFolder()}},"Open Folder"),this.actionsFolder.open(),this.frameSettingsFolder=this.gui.addFolder("Frames"),this.frameSettingsFolder.add(this.recordParams,"frames",1,20).step(1).name("Frames").listen(),this.frameSettingsFolder.add(this.recordParams,"frameSize",32,1024).step(32).name("Frame Size").listen().onChange((function(t){o.setSize(t,t),e.onWindowResize()})),this.frameSettingsFolder.add(this.recordParams,"sheetSize",64,16384).step(64).name("Sheet Size").listen(),this.frameSettingsFolder.add(this.recordParams,"compressPNG").name("Compress PNG").listen(),this.frameSettingsFolder.add(this.recordParams,"packTextures").name("Pack Textures").listen();var h=d.addFolder("Lights");h.add(n,"intensity",0,5).name("Ambient Light").step(.01).listen(),h.add(r,"intensity",0,5).name("Directional Light").step(.01).listen(),h.add(a,"intensity",0,5).name("Hemisphere Light").step(.01).listen(),h.add(this.recordParams,"shadow").name("Shadows").listen().onChange((function(){e.updateAngle(e.currentAngleName)})),h.add(this.recordParams,"shadowHeightAngle",1,179).name("Shadow Height Angle").listen().onChange((function(){e.angles=C(e.modelDimensions,e.config,e.recordParams),e.updateAngle(e.currentAngleName)})),h.add(this.recordParams,"shadowSideAngle",1,179).name("Shadow Side Angle").listen().onChange((function(){e.angles=C(e.modelDimensions,e.config,e.recordParams),e.updateAngle(e.currentAngleName)})),h.add(this.recordParams,"shadowDistance",.1,5).step(.05).name("Shadow Distance").listen().onChange((function(){e.angles=C(e.modelDimensions,e.config,e.recordParams),e.updateAngle(e.currentAngleName)})),h.add(this.recordParams,"shadowOpacity",.05,1).step(.05).name("Shadow Opacity").listen().onChange((function(){e.updateAngle(e.currentAngleName)}));var f=new u["J"](2e3,2e3,8,8),g=new u["Q"]({opacity:.8}),x=new u["C"](f,g);x.castShadow=!1,x.receiveShadow=!0,x.rotateX(-Math.PI/2),this.floorPlane=x,this.floorMaterial=g,t.add(x);var v=new u["h"],b=function t(){requestAnimationFrame(t),s.update(),e.modelReady&&!e.isRecording&&e.mixer.update(v.getDelta()),F(),c.update()};function F(){o.render(t,i)}b()},destroyed:function(){this.gui.destroy()}};function W(){return new Promise((function(e){requestAnimationFrame((function(){e()}))}))}function B(e,t){return new Promise((function(n,r){e.load(t,(function(e){n(e)}),(function(e){}),(function(e){console.error(e),r(e)}))}))}var G=U,J=(n("034f"),n("2877")),q=Object(J["a"])(G,a,i,!1,null,null,null),K=q.exports;r["a"].config.productionTip=!1,new r["a"]({render:function(e){return e(K)}}).$mount("#app")},"85ec":function(e,t,n){},a2d6:function(e){e.exports=JSON.parse('{"name":"Demo","model":"models/ToonRTS_demo_Knight/model.FBX","texture":"models/ToonRTS_demo_Knight/DemoTexture.tga","animations":{"idle":{"name":"models/ToonRTS_demo_Knight/model@idle.FBX","frames":1},"walk":{"name":"models/ToonRTS_demo_Knight/model@walk.FBX","frames":6},"run":{"name":"models/ToonRTS_demo_Knight/model@run.FBX","frames":8},"attack":{"name":"models/ToonRTS_demo_Knight/model@attack.FBX","frames":12,"skipEnd":0.4}},"icon":{"animation":"idle","size":512},"viewAngle":60,"shadowHeightAngle":80}')}});
//# sourceMappingURL=app.7d3a6a57.js.map